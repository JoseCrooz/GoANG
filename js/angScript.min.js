var app={pageBg:$("#page-bg"),pages:$(".page"),timelineLinks:$("#footer-nav a"),timelineBackground:$("#footer-nav-bg"),overlay:$("#overlay"),modalVideo:$("#modal-video"),modalVideo2:$("#modal-video2"),modalGallery:$("#modal-gallery"),footer:$("#footer"),isFooterRaised:false,pageCoords:[["0","0 0 0 -1280px","-650px 0 0 -2560px","0 0 0 -3840px","-650px 0 0 -1280px","-1300px 0 0 -1280px","-1300px 0 0 0","-650px 0 0 0"],["-800px 0","-730px 0","-675px 0","-610px 0","-530px 0","-410px 0","-330px 0","0 0"]],currentPos:{x:0,y:112},moveToPos:[{x:0,y:112},{x:-1280,y:112},{x:-2560,y:-538},{x:-3840,y:-1188},{x:-3840,y:112},{x:-1350,y:-538},{x:0,y:-1188},{x:0,y:-538}],activePage:0,init:function(){app.interactiveMap.init();app.pageFooter.init();app.chopperMenu.init()},showOverlay:function(a){$(app.overlay).fadeIn(function(){$(a).fadeIn()})},hideOverlay:function(a){$(a).fadeOut(function(){$(app.overlay).fadeOut()})},page:function(c){var a=app.pageCoords[0][c];var b=app.pageCoords[1][c];app.moveToPath(c);app.pages.eq(app.activePage).css({zIndex:2});app.pages.eq(c).css({zIndex:3});app.pages.eq(app.activePage).children().removeClass("animated");app.pages.eq(c).children().addClass("animated");app.timelineBackground.css({backgroundPosition:b});app.timelineLinks.removeClass("active complete");for(i=0;i<c;i++){app.timelineLinks.eq(i).addClass("complete")}app.timelineLinks.eq(c).addClass("active");app.activePage=c;if(c>0){$(".secondary-nav").addClass("secondary-nav-active")}else{if(c==0){$(".secondary-nav").removeClass("secondary-nav-active")}}},moveToPath:function(g){var e=g;var j=app.moveToPos[g].x;var h=app.moveToPos[g].y;var b=app.currentPos.x;var a=app.currentPos.y;var f=50;var c=0;var d=0.2;if(a==h&&app.activePage>e){f*=-1}if(a==112&&h<112){f*=-1}var k=new $.path.bezier({start:{x:b,y:a,angle:f},end:{x:j,y:h,angle:c,length:d}});$("#page-bg").animate({path:k},3000);app.currentPos.x=app.moveToPos[g].x;app.currentPos.y=app.moveToPos[g].y},interactiveMap:{mapSpot:$(".mapSpot"),hurricanePath:$(".hurricanePath"),mapHotspotTitle:$(".mapHotspotTitle"),mapDetails:$(".mapDetails"),tabbedContent:$(".tabedContent"),mapHeadline:$("#page-1.headline"),activeIndex:-1,init:function(){app.interactiveMap.mapToggle();app.interactiveMap.fadeDownMapBGs()},mapToggle:function(){app.interactiveMap.mapSpot.click(function(){var a=$(this).index();app.interactiveMap.mapSpot.removeClass("activeMapSpot");app.interactiveMap.mapHotspotTitle.fadeTo(25,0.5);app.interactiveMap.mapDetails.fadeTo(25,0.5);app.interactiveMap.tabbedContent.css({left:0});var b=$(this).attr("rel");app.interactiveMap.fadeDownMapBG();app.interactiveMap.fadeUpMapBG(b+"Content");if(app.interactiveMap.activeIndex!==a){$(this).addClass("activeMapSpot");$(this).children(".mapHotspotTitle").fadeOut(25,function(){});$(this).children(".mapDetails").fadeOut(25,function(){});$("#page-1").children(".headline").fadeOut(25,function(){});app.interactiveMap.activeIndex=$(this).index()}else{app.interactiveMap.activeIndex=-1;app.interactiveMap.setToDefault()}})},fadeDownMapBGs:function(){app.interactiveMap.tabbedContent.children().fadeOut()},fadeUpMapBG:function(a){console.log("should fade up"+a);$("#"+a).fadeTo("slow",1,function(){})},fadeDownMapBG:function(a){app.interactiveMap.tabbedContent.children().fadeOut()},setToDefault:function(){$("#page-1").children(".headline").fadeIn(25);app.interactiveMap.fadeDownMapBGs();app.interactiveMap.mapHotspotTitle.fadeTo(25,1);app.interactiveMap.mapDetails.fadeTo(25,1);app.interactiveMap.mapSpot.removeClass("activeMapSpot");app.interactiveMap.activeIndex=-1}},chopperMenu:{chopperLink:$(".chopper-link"),activeLink:$("#pilot"),init:function(){app.chopperMenu.chopperNavigation()},chopperNavigation:function(){var c=$("#job1");var a=$("#chopper-job1");var b=$("#dots-job1");c.addClass("active-job");app.chopperMenu.chopperLink.click(function(){c.removeClass("active-job");a.fadeOut(25,function(){});b.fadeOut(25,function(){});c=$("#"+this.id);a=$("#chopper-"+this.id);b=$("#dots-"+this.id);c.addClass("active-job");a.fadeTo("slow",1);b.fadeTo("slow",1)})},toggle:function(){$(".chopper-job-intro").fadeOut(25,function(){});$(".headline").fadeOut(25,function(){});$(".chopper-jobs").fadeTo("slow",1)},reset:function(){$(".chopper-jobs").fadeOut(25,function(){});$(".chopper-job-intro").fadeTo("slow",1);$(".headline").fadeTo("slow",1)}},pageFooter:{isTimelineRaised:false,isLocatorRaised:false,activeCategory:"rescue",activeMission:"irene",init:function(){app.pageFooter.setActiveMission();app.pageFooter.missions()},missions:function(){},moveTimeline:function(){if(!app.pageFooter.isTimelineRaised){$(".footer").addClass("footer-open");$("#footer-arrow").addClass("rotate-arrow");app.pageFooter.isTimelineRaised=true}else{$(".footer").removeClass("footer-open");$(".footer-arrow").removeClass("rotate-arrow");app.pageFooter.isTimelineRaised=false}},moveLocator:function(){if(!app.pageFooter.isLocatorRaised){$("#locator").css("bottom","0px");$(app.overlay).fadeIn();app.pageFooter.isLocatorRaised=true}else{$("#locator").css("bottom","-500px");$(app.overlay).fadeOut();app.pageFooter.isLocatorRaised=false}},setActiveMission:function(){$("#"+app.pageFooter.activeCategory).children().css({opacity:1});$("#mission-"+app.pageFooter.activeCategory).addClass(".mission-active")}},addModule:function(b){if(!b){throw new SyntaxError("add_module(name): name is undefined");return false}if(b in this){throw new SyntaxError("add_module(name): '"+b+"' already declared");return false}if(this.name==b){throw new SyntaxError("add_module(name): a module cannot have the same name as the application");return false}return this[b]=new a(b);function a(c){this.data={};this.name=c}a.prototype.setData=function(c,f){var e=(typeof c);if(!c){throw new SyntaxError("setData(key, value): key is undefined")}if(e=="string"&&typeof f=="undefined"){throw new SyntaxError("setData(key, value): value is undefined")}if(e=="string"){this.data[c]=f}else{if(e=="object"){for(var d in c){this.data[d]=c[d]}}}return this};a.prototype.listener=function(d,c){if(typeof this[d]=="function"){this[d](c)}}}};var deepLinks=Backbone.Router.extend({routes:{"*hash":"hashHandler"},hashHandler:function(a){if(app.pageFooter.isTimelineRaised){app.pageFooter.moveTimeline()}switch(a){case"first":app.page(0);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"second":app.page(1);break;case"third":app.page(2);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"fourth":app.page(3);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"fifth":app.page(4);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"sixth":app.page(5);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"seventh":app.page(6);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;case"eighth":app.page(7);app.interactiveMap.setToDefault();app.chopperMenu.reset();break;default:app.page(0)}}});new deepLinks();try{Backbone.history.start()}catch(err){Backbone.history.loadUrl()}app.init();